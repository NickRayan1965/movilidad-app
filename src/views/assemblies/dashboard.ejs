<script src="/js/assemblyTypesApi.js"></script>
<script src="/js/assembliesApi.js"></script>
<script src="/js/dateUtils.js"></script>

<style>

  /* .form-control {
    font-size: 2.1rem;
    padding: 2rem;
    border-radius: 12px;
  }
  .btn-turquesa {
    background-color: #1abc9c;
    border: none;
    font-size: 2.2rem;
    padding: 0.9rem;
    border-radius: 12px;
  }
  .btn-turquesa:hover {
    background-color: #16a085;
  }
  .form-control:focus {
    border-color: #1abc9c;
    box-shadow: 0 0 0 0.2rem rgba(26, 188, 156, 0.25);
  } */
</style>
<%- include('../partials/assemblies/new-assembly-modal') %>

<div class="standar-wrapper">
  <div class="card standar-card">
    <h4 class="mb-4" style="color:#1abc9c;">Mis Asambleas...</h4>
    <div class="standar-container">
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-main text-white fw-bold" data-bs-toggle="modal" data-bs-target="#assemblyModal">
          NUEVO
        </button>
      </div>
      <div class="mt-3 w-100" id="items-container">
               
      </div>
    </div>
  </div>
</div>
<script>
  let assembliesData = null;
  function fillAssemblies(data) {
    const e = $('#items-container');
    e.html('');
    data?.forEach(assembly => {
      let date = '';
      const { PRIMER_DIA_ASAMBLEA, ULTIMO_DIA_ASAMBLEA } = assembly;
      if (PRIMER_DIA_ASAMBLEA) {
        date += formatReadableDate(PRIMER_DIA_ASAMBLEA);
      }
      if (ULTIMO_DIA_ASAMBLEA && ULTIMO_DIA_ASAMBLEA !== PRIMER_DIA_ASAMBLEA) {
        date += ' - ' + formatReadableDate(ULTIMO_DIA_ASAMBLEA);
      }
      const itemId = `assembly-item-${assembly.CODIGO_ASAMBLEA}`;
      e.append(`
        <div class="btn btn-light mb-3 w-100" id="${itemId}">
          <button class="w-100 mb-3 rounded borders py-4 px-3 btn btn-link">
            <div class="fw-bold fs-2 text-start">${assembly.NOMBRE_ASAMBLEA}</div>
            <div class="fs-3 text-end">${date}</div>
          </button>
        </div> 
      `);
      $(`#${itemId}`).on('click', function() {
        window.location.href = '/assemblies/' + assembly.CODIGO_ASAMBLEA;
      });
    });
  }
  $(async function() {
    assembliesData = await getAssemblies();
    fillAssemblies(assembliesData);
  });
</script>